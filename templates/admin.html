<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Botlab Suite Admin Paneli</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background: radial-gradient(circle at top, #141829, #0b0e1b 70%);
            font-family: 'Inter', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.07);
        }

        .neon-border {
            border: 1px solid rgba(35, 120, 255, 0.35);
            box-shadow: 0 0 18px rgba(35, 120, 255, 0.4);
        }

        .neon-btn {
            background: linear-gradient(to right, #ff8a00, #ffc45c);
            color: #1a1a1a;
            font-weight: 600;
            box-shadow: 0 0 14px rgba(255, 166, 0, 0.7);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.07);
        }

        .menu-item.active {
            background: rgba(35, 120, 255, 0.2);
            border: 1px solid rgba(35, 120, 255, 0.4);
            box-shadow: 0 0 12px rgba(35, 120, 255, 0.4);
        }

        .input-box {
            background: #1c2237;
            border: 1px solid #4b5563;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            color: white;
        }
    </style>
</head>

<body class="text-gray-200">

    <!-- HEADER -->
    <header class="w-full glass border-b border-white/10 shadow-lg">
        <div class="max-w-7xl mx-auto py-4 px-6 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white tracking-wide">
                üí† Botlab Suite ¬∑ Admin Paneli
            </h1>

            <div class="flex items-center space-x-3">
                <span id="adminEmail" class="text-gray-300 text-sm"></span>

                <button onclick="logoutAdmin()" 
                    class="px-5 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-500 transition">
                    √áƒ±kƒ±≈ü Yap
                </button>
            </div>
        </div>
    </header>


    <!-- MAIN LAYOUT -->
    <div class="max-w-7xl mx-auto py-10 px-6 grid grid-cols-1 lg:grid-cols-4 gap-8">

        <!-- SIDEBAR -->
        <aside class="glass neon-border rounded-2xl p-6 h-fit sticky top-6">

            <h2 class="text-lg font-bold text-blue-400 mb-4">MEN√ú</h2>

            <div class="space-y-2">

                <div class="menu-item active" onclick="showSection(event, 'premiumUsers')">
                    <span>üë§</span> <span>Premium Kullanƒ±cƒ±lar</span>
                </div>

                <div class="menu-item" onclick="showSection(event, 'toolLimits')">
                    <span>‚öô</span> <span>Ara√ß Limit Ayarlarƒ±</span>
                </div>

                <div class="menu-item" onclick="showSection(event, 'popupSettings')">
                    <span>üíé</span> <span>Premium Popup Ayarlarƒ±</span>
                </div>

                <div class="menu-item" onclick="showSection(event, 'globalSettings')">
                    <span>üåç</span> <span>Genel Site Ayarlarƒ±</span>
                </div>

                <div class="menu-item" onclick="showSection(event, 'adminSettings')">
                    <span>üîê</span> <span>Admin Bilgileri</span>
                </div>

            </div>

        </aside>


        <!-- MAIN CONTENT -->
        <section id="panelContent" class="lg:col-span-3 glass neon-border rounded-2xl p-8">
            Y√ºkleniyor‚Ä¶
        </section>

    </div>


<!-- ============================== -->
<!-- PART 2 ‚Äì TEMPLATES (PREMIUM / LIMITS / POPUP / GLOBAL / ADMIN) -->
<!-- ============================== -->

<script>

// =========================
// Premium Users Template
// =========================
const premiumUsersHTML = `
    <h2 class="text-2xl font-bold mb-6 text-white">üë§ Premium Kullanƒ±cƒ±lar</h2>

    <div class="flex justify-between items-center mb-4">
        <p class="text-gray-400">Premium eri≈üimi olan kullanƒ±cƒ±larƒ± g√∂r√ºnt√ºleyin ve y√∂netin.</p>
        <button onclick="openAddUserModal()"
            class="px-5 py-2 neon-btn rounded-lg hover:opacity-90">
            + Yeni Kullanƒ±cƒ±
        </button>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full text-left text-gray-300 border border-gray-700 rounded-xl overflow-hidden">
            <thead class="bg-[#1f253d] text-gray-200">
                <tr>
                    <th class="p-3">E-posta</th>
                    <th class="p-3">Ba≈ülangƒ±√ß</th>
                    <th class="p-3">Biti≈ü</th>
                    <th class="p-3">Durum</th>
                    <th class="p-3">Kullanƒ±m</th>
                    <th class="p-3">ƒ∞≈ülem</th>
                </tr>
            </thead>
            <tbody id="premiumUsersTable" class="divide-y divide-gray-700">
                <tr><td colspan="6" class="p-4 text-gray-400">Y√ºkleniyor‚Ä¶</td></tr>
            </tbody>
        </table>
    </div>

    <!-- Add Modal -->
    <div id="addUserModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden flex items-center justify-center z-50">

        <div class="glass neon-border p-8 rounded-2xl w-full max-w-md">
            <h3 class="text-xl font-bold mb-4 text-white">Yeni Premium Kullanƒ±cƒ±</h3>

            <label>E-posta</label>
            <input id="newEmail" class="input-box mb-4" placeholder="kullanici@mail.com">

            <label>S√ºre (G√ºn)</label>
            <input id="newDays" type="number" class="input-box mb-4" placeholder="30">

            <button onclick="saveNewUser()" class="w-full neon-btn py-3 rounded-lg">Kaydet</button>

            <button onclick="closeAddUserModal()" class="text-gray-400 mt-4 w-full underline text-sm">ƒ∞ptal</button>
        </div>

    </div>
`;


// =========================
// Tool Limits Template
// =========================
const toolLimitsHTML = `
    <h2 class="text-2xl font-bold mb-6 text-white">‚öô Ara√ß Limit Ayarlarƒ±</h2>

    <div class="glass p-6 rounded-xl mb-6">

        <h3 class="text-xl font-bold text-blue-300 mb-3">üìÑ PDF Ara√ßlarƒ±</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label>PDF B√∂lme √úcretsiz Limit</label>
                <input id="pdf_split_free" class="input-box mt-1">
            </div>
            <div>
                <label>PDF B√∂lme Premium Limit</label>
                <input id="pdf_split_premium" class="input-box mt-1">
            </div>

            <div>
                <label>PDF Birle≈ütirme √úcretsiz Limit</label>
                <input id="pdf_merge_free" class="input-box mt-1">
            </div>
            <div>
                <label>PDF Birle≈ütirme Premium Limit</label>
                <input id="pdf_merge_premium" class="input-box mt-1">
            </div>

            <div>
                <label>Maksimum PDF Boyutu (MB)</label>
                <input id="pdf_max_size" class="input-box mt-1">
            </div>
        </div>
    </div>


    <div class="glass p-6 rounded-xl mb-6">

        <h3 class="text-xl font-bold text-blue-300 mb-3">üñº G√∂rsel Ara√ßlarƒ±</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label>Arka Plan Silici √úcretsiz √á√∂z√ºn√ºrl√ºk</label>
                <input id="bg_free" class="input-box mt-1">
            </div>
            <div>
                <label>Arka Plan Silici Premium √á√∂z√ºn√ºrl√ºk</label>
                <input id="bg_premium" class="input-box mt-1">
            </div>

            <div>
                <label>Format D√∂n√º≈üt√ºr√ºc√º √úcretsiz Limit</label>
                <input id="format_free" class="input-box mt-1">
            </div>
            <div>
                <label>Format D√∂n√º≈üt√ºr√ºc√º Premium Limit</label>
                <input id="format_premium" class="input-box mt-1">
            </div>
        </div>
    </div>


    <div class="glass p-6 rounded-xl mb-6">
        <h3 class="text-xl font-bold text-blue-300 mb-3">‚úè Vekt√∂r Aracƒ±</h3>

        <label>√úcretsiz Limit</label>
        <input id="vector_free" class="input-box mt-1 mb-3">

        <label>Premium Limit</label>
        <input id="vector_premium" class="input-box mt-1 mb-3">
    </div>

    <button onclick="saveToolLimits()"
        class="w-full neon-btn py-3 rounded-lg">Kaydet</button>
`;


// =========================
// Popup Settings Template
// =========================
const popupHTML = `
    <h2 class="text-2xl font-bold mb-6 text-white">üíé Premium Popup Ayarlarƒ±</h2>

    <div class="glass p-6 rounded-xl space-y-6">

        <div>
            <label>Ba≈ülƒ±k</label>
            <input id="popup_title" class="input-box mt-1">
        </div>

        <div>
            <label>A√ßƒ±klama</label>
            <textarea id="popup_desc" class="input-box mt-1 h-32"></textarea>
        </div>

        <div>
            <label>Avantajlar (her satƒ±r bir madde)</label>
            <textarea id="popup_benefits" class="input-box mt-1 h-40"></textarea>
        </div>

        <div>
            <label>WhatsApp Numarasƒ±</label>
            <input id="popup_phone" class="input-box mt-1" placeholder="905335620807">
        </div>

        <button onclick="savePopupSettings()"
            class="w-full neon-btn py-3 rounded-lg">Kaydet</button>

    </div>
`;


// =========================
// Global Settings Template
// =========================
const globalHTML = `
    <h2 class="text-2xl font-bold mb-6 text-white">üåç Genel Site Ayarlarƒ±</h2>

    <div class="glass p-6 rounded-xl space-y-6">
        <div>
            <label>Site Ba≈ülƒ±ƒüƒ±</label>
            <input id="site_title" class="input-box mt-1">
        </div>

        <div>
            <label>Footer Yazƒ±sƒ±</label>
            <input id="footer_text" class="input-box mt-1">
        </div>

        <button onclick="saveGlobalSettings()" 
            class="w-full neon-btn py-3 rounded-lg">Kaydet</button>
    </div>
`;


// =========================
// Admin Settings Template
// =========================
const adminSettingsHTML = `
    <h2 class="text-2xl font-bold mb-6 text-white">üîê Admin Bilgileri</h2>

    <div class="glass p-6 rounded-xl space-y-6">

        <div>
            <label>Email</label>
            <input id="admin_email_change" class="input-box mt-1">
        </div>

        <div>
            <label>Yeni ≈ûifre</label>
            <input id="admin_password_change" type="password" class="input-box mt-1">
        </div>

        <button onclick="saveAdminSettings()" 
            class="w-full neon-btn py-3 rounded-lg">Kaydet</button>

    </div>
`;

</script>

<!-- ============================== -->
<!-- PART 3 ‚Äì JAVASCRIPT FUNCTIONS -->
<!-- ============================== -->

<script>

// ======================
// Section Switcher
// ======================
function showSection(e, section) {
    document.querySelectorAll(".menu-item").forEach(i => i.classList.remove("active"));
    e.currentTarget.classList.add("active");

    const panel = document.getElementById("panelContent");

    if (section === "premiumUsers") {
        panel.innerHTML = premiumUsersHTML;
        loadPremiumUsers();
    }

    if (section === "toolLimits") {
        panel.innerHTML = toolLimitsHTML;
        loadToolLimits();
    }

    if (section === "popupSettings") {
        panel.innerHTML = popupHTML;
        loadPopupSettings();
    }

    if (section === "globalSettings") {
        panel.innerHTML = globalHTML;
        loadGlobalSettings();
    }

    if (section === "adminSettings") {
        panel.innerHTML = adminSettingsHTML;
        loadAdminSettings();
    }
}


// ======================
// Load Admin Header Info
// ======================
async function loadAdminInfo() {
    try {
        const res = await fetch("/get_settings");
        const data = await res.json();
        document.getElementById("adminEmail").innerText = data.admin.email;
    } catch(e) {
        console.log("Admin email y√ºklenemedi");
    }
}
loadAdminInfo();


// ======================
// Load Premium Users
// ======================
async function loadPremiumUsers() {
    const table = document.getElementById("premiumUsersTable");
    if (!table) return;

    const res = await fetch("/get_premium_users");
    const users = await res.json();

    if (!users.length) {
        table.innerHTML = `<tr><td colspan="6" class="p-4 text-gray-400">Premium kullanƒ±cƒ± yok.</td></tr>`;
        return;
    }

    table.innerHTML = users.map(u => `
        <tr>
            <td class="p-3">${u.email}</td>
            <td class="p-3">${u.start}</td>
            <td class="p-3">${u.end}</td>
            <td class="p-3">${u.active ? "Aktif" : "Pasif"}</td>
            <td class="p-3">${u.usage}</td>
            <td class="p-3">
                <button onclick="resetUsage('${u.email}')" class="text-blue-400 underline">Sƒ±fƒ±rla</button> |
                <button onclick="deleteUser('${u.email}')" class="text-red-400 underline">Sil</button>
            </td>
        </tr>
    `).join("");
}


// ======================
// Add New Premium User
// ======================
function openAddUserModal() {
    document.getElementById("addUserModal").classList.remove("hidden");
}

function closeAddUserModal() {
    document.getElementById("addUserModal").classList.add("hidden");
}

async function saveNewUser() {
    const email = document.getElementById("newEmail").value.trim();
    const days = parseInt(document.getElementById("newDays").value);

    if (!email || !days) return alert("T√ºm alanlarƒ± doldurun.");

    await fetch("/add_premium_user", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({email, days})
    });

    closeAddUserModal();
    showSection(event, 'premiumUsers');
}


// ======================
// Delete User
// ======================
async function deleteUser(email) {
    if (!confirm(`${email} silinsin mi?`)) return;

    await fetch("/delete_premium_user", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({email})
    });

    showSection(event, 'premiumUsers');
}


// ======================
// Reset Usage
// ======================
async function resetUsage(email) {
    await fetch("/reset_usage", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({email})
    });

    showSection(event, 'premiumUsers');
}


// ======================
// Load Tool Limits
// ======================
async function loadToolLimits() {
    const res = await fetch("/get_settings");
    const s = await res.json();

    document.getElementById("pdf_split_free").value = s.limits.pdf.split.free;
    document.getElementById("pdf_split_premium").value = s.limits.pdf.split.premium;
    document.getElementById("pdf_merge_free").value = s.limits.pdf.merge.free;
    document.getElementById("pdf_merge_premium").value = s.limits.pdf.merge.premium;
    document.getElementById("pdf_max_size").value = s.limits.pdf.max_size;

    document.getElementById("bg_free").value = s.limits.image.bg_free;
    document.getElementById("bg_premium").value = s.limits.image.bg_premium;

    document.getElementById("format_free").value = s.limits.image.convert_free;
    document.getElementById("format_premium").value = s.limits.image.convert_premium;

    document.getElementById("vector_free").value = s.limits.vector.free;
    document.getElementById("vector_premium").value = s.limits.vector.premium;
}


// ======================
// Save Tool Limits
// ======================
async function saveToolLimits() {
    const payload = {
        pdf: {
            split: {
                free: document.getElementById("pdf_split_free").value,
                premium: document.getElementById("pdf_split_premium").value
            },
            merge: {
                free: document.getElementById("pdf_merge_free").value,
                premium: document.getElementById("pdf_merge_premium").value
            },
            max_size: document.getElementById("pdf_max_size").value
        },
        image: {
            bg_free: document.getElementById("bg_free").value,
            bg_premium: document.getElementById("bg_premium").value,
            convert_free: document.getElementById("format_free").value,
            convert_premium: document.getElementById("format_premium").value
        },
        vector: {
            free: document.getElementById("vector_free").value,
            premium: document.getElementById("vector_premium").value
        }
    };

    await fetch("/save_tool_limits", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });

    alert("Limitler kaydedildi.");
}


// ======================
// Popup Settings
// ======================
async function loadPopupSettings() {
    const res = await fetch("/get_settings");
    const s = await res.json();

    document.getElementById("popup_title").value = s.popup.title;
    document.getElementById("popup_desc").value = s.popup.desc;
    document.getElementById("popup_benefits").value = s.popup.benefits.join("\n");
    document.getElementById("popup_phone").value = s.popup.phone;
}

async function savePopupSettings() {
    const payload = {
        title: document.getElementById("popup_title").value,
        desc: document.getElementById("popup_desc").value,
        benefits: document.getElementById("popup_benefits").value.split("\n"),
        phone: document.getElementById("popup_phone").value
    };

    await fetch("/save_popup", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });

    alert("Popup ayarlarƒ± kaydedildi.");
}


// ======================
// Global Settings
// ======================
async function loadGlobalSettings() {
    const res = await fetch("/get_settings");
    const s = await res.json();

    document.getElementById("site_title").value = s.site.title;
    document.getElementById("footer_text").value = s.site.footer;
}

async function saveGlobalSettings() {
    const payload = {
        title: document.getElementById("site_title").value,
        footer: document.getElementById("footer_text").value
    };

    await fetch("/save_global_settings", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });

    alert("Genel ayarlar kaydedildi.");
}


// ======================
// Admin Settings
// ======================
async function loadAdminSettings() {
    const res = await fetch("/get_settings");
    const s = await res.json();

    document.getElementById("admin_email_change").value = s.admin.email;
}

async function saveAdminSettings() {
    const payload = {
        email: document.getElementById("admin_email_change").value,
        password: document.getElementById("admin_password_change").value
    };

    await fetch("/save_admin", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload)
    });

    alert("Admin bilgileri g√ºncellendi.");
}


// ======================
// Logout
// ======================
function logoutAdmin() {
    window.location.href = "/admin_logout";
}

</script>

</body>
</html>
