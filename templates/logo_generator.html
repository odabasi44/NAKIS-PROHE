{% extends "base.html" %}

{% block title %}AI Logo Oluşturucu{% endblock title %}

{% block content %}
<main class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 py-10">
    <div class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-white">AI Logo Oluşturucu</h1>
        <p class="mt-2 text-gray-400">Marka adı → stil → üret → indir (PNG).</p>
    </div>

    <div id="status-bar" class="glass rounded-2xl p-4 mb-6 flex items-center justify-between border border-white/5">
        <div class="flex items-center gap-3">
            <span id="status-icon" class="h-2 w-2 rounded-full bg-gray-500 animate-pulse"></span>
            <div id="limit-info" class="text-sm text-gray-300">Limitler kontrol ediliyor...</div>
        </div>
        <div class="text-xs text-gray-500">Logo</div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <section class="glass rounded-2xl p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="md:col-span-2">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1 block">Marka İsmi</label>
                    <input id="brandName" class="w-full bg-[#02040a] border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-pink-500/60 transition" placeholder="Örn: Botlab Cafe" />
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1 block">Stil</label>
                    <select id="style" class="w-full bg-[#02040a] border border-white/10 rounded-xl px-4 py-3 text-gray-200 focus:outline-none focus:border-pink-500/60 transition">
                        <option value="minimal">Minimal</option>
                        <option value="badge">Badge</option>
                        <option value="mono">Mono</option>
                    </select>
                </div>
            </div>

            <button id="genBtn" type="button" class="mt-5 w-full py-4 rounded-xl bg-gradient-to-r from-pink-600 to-purple-600 hover:opacity-90 text-white font-bold transition">
                Logo Üret
            </button>
            <div class="mt-3 text-[10px] text-gray-500">Not: Stil seçimi şimdilik sadece UI (backend tek tip üretim yapar).</div>
        </section>

        <section class="glass rounded-2xl p-6 flex flex-col items-center justify-center">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
                <img id="logoResult" class="max-w-[360px] rounded-xl bg-black/30" alt="Logo Önizleme" />
            </div>
            <a id="downloadLogo" href="#" download="logo.png" class="mt-4 text-xs font-bold text-pink-300 hover:text-pink-200 underline hidden">Logoyu İndir (PNG)</a>
        </section>
    </div>
</main>

<script>
    let userAllowed = false;

    async function checkLimit() {
        try {
            const res = await fetch('/api/check_tool_status/generator/logo');
            const data = await res.json();
            userAllowed = data.allowed;
            const limitInfo = document.getElementById('limit-info');
            const statusIcon = document.getElementById('status-icon');

            if(data.allowed) {
                statusIcon.className = "h-2 w-2 rounded-full bg-green-500";
                limitInfo.innerHTML = `Kalan Hakkınız: <span class="text-green-400 font-bold">${data.premium ? 'Sınırsız' : data.left}</span>`;
            } else {
                statusIcon.className = "h-2 w-2 rounded-full bg-red-500";
                limitInfo.innerHTML = `⛔ Limit Doldu. <a onclick="openModal('premiumModal')" class="text-blue-400 cursor-pointer">Premium Al</a>`;
            }
        } catch(e) {}
    }

    async function generateLogo() {
        const text = document.getElementById('brandName').value;
        if(!text) return alert("Marka ismi girin.");
        if(!userAllowed) return openModal('premiumModal');

        try {
            const res = await fetch('/api/logo_generator', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ text })
            });
            const data = await res.json();

            if(data.success) {
                const src = "data:image/png;base64," + data.file;
                document.getElementById('logoResult').src = src;
                document.getElementById('downloadLogo').href = src;
                document.getElementById('downloadLogo').classList.remove('hidden');
                checkLimit();
            } else {
                alert("Hata: " + data.reason);
                if(data.reason === 'limit') openModal('premiumModal');
            }
        } catch(e) { alert("Hata oluştu."); }
    }

    document.getElementById('genBtn').addEventListener('click', generateLogo);
    document.addEventListener('DOMContentLoaded', checkLimit);
</script>
{% endblock content %}
