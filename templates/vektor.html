{% extends "base.html" %}

{% block title %}AI Nakƒ±≈ü & Vekt√∂r St√ºdyosu{% endblock title %}

{% block head_extra %}
<style>
    /* CAM PANEL EFEKTLERƒ∞ */
    .glass-panel {
        background: rgba(17, 24, 39, 0.6);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        transition: all 0.3s ease;
    }

    /* MOD SE√áƒ∞M KARTLARI */
    .mode-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    .mode-card:hover {
        transform: translateY(-5px);
        border-color: #8b5cf6;
        box-shadow: 0 10px 30px -10px rgba(139, 92, 246, 0.2);
    }
    .mode-card.selected {
        background: linear-gradient(145deg, rgba(139, 92, 246, 0.15), rgba(17, 24, 39, 0.9));
        border-color: #8b5cf6;
        box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.5);
    }
    .mode-card.selected .check-icon { opacity: 1; transform: scale(1); }

    /* TARAMA EFEKTƒ∞ (LOADING) */
    .scan-line {
        position: absolute; width: 100%; height: 2px;
        background: #8b5cf6; box-shadow: 0 0 15px #8b5cf6;
        animation: scan 2s linear infinite;
        z-index: 10;
    }
    @keyframes scan { 0% {top: 0%} 50% {top: 100%} 100% {top: 0%} }

    /* RADYO BUTON & CHECKBOX STƒ∞LLERƒ∞ */
    input[type="radio"]:checked + div {
        border-color: #8b5cf6;
        background-color: rgba(139, 92, 246, 0.1);
    }
    input[type="radio"]:checked + div span { color: white; }
    
    /* KALƒ∞TE BUTONLARI */
    .quality-btn.active {
        background: rgba(139, 92, 246, 0.2);
        border-color: #8b5cf6;
        color: white;
        box-shadow: 0 0 15px rgba(139, 92, 246, 0.15);
    }
</style>
{% endblock head_extra %}

{% block content %}
<div class="w-full max-w-6xl mx-auto space-y-12 pb-20">

    <div class="text-center animate-fade-in">
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4 tracking-tight">
            AI <span class="text-transparent bg-clip-text bg-gradient-to-r from-violet-400 to-fuchsia-400">Nakƒ±≈ü St√ºdyosu</span>
        </h1>
        <p class="text-gray-400 max-w-2xl mx-auto text-lg">
            G√∂rselinizi y√ºkleyin, yapay zeka saniyeler i√ßinde Wilcom uyumlu vekt√∂r √ßizimini ve makine dosyasƒ±nƒ± hazƒ±rlasƒ±n.
        </p>
    </div>

    <div id="step-1" class="animate-fade-in">
        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4 ml-1">1. Ne D√∂n√º≈üt√ºreceksiniz?</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div onclick="selectMode('logo')" id="card-logo" class="mode-card bg-[#0c1120] border border-white/10 rounded-2xl p-6 flex items-start gap-5">
                <div class="w-14 h-14 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 shrink-0">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-white mb-1">Logo & Grafik</h4>
                    <p class="text-sm text-gray-400 leading-relaxed">Vekt√∂rel, net kenarlƒ± √ßizimler. Arka plan otomatik temizlenir.</p>
                    <div class="mt-3 flex gap-2">
                        <span class="text-[9px] bg-blue-500/10 text-blue-300 px-2 py-1 rounded border border-blue-500/20">Auto BG Silme</span>
                        <span class="text-[9px] bg-blue-500/10 text-blue-300 px-2 py-1 rounded border border-blue-500/20">Keskin Hat</span>
                    </div>
                </div>
                <div class="check-icon absolute top-4 right-4 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center opacity-0 transform scale-50 transition-all duration-300 shadow-lg shadow-blue-500/50">
                    <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                </div>
            </div>

            <div onclick="selectMode('photo')" id="card-photo" class="mode-card bg-[#0c1120] border border-white/10 rounded-2xl p-6 flex items-start gap-5">
                <div class="w-14 h-14 rounded-xl bg-fuchsia-500/10 flex items-center justify-center text-fuchsia-400 shrink-0">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-white mb-1">Fotoƒüraf & Resim</h4>
                    <p class="text-sm text-gray-400 leading-relaxed">ƒ∞nsan veya manzara. ERC v4 motoru ile nakƒ±≈üa uygun cartoon stili.</p>
                    <div class="mt-3 flex gap-2">
                        <span class="text-[9px] bg-fuchsia-500/10 text-fuchsia-300 px-2 py-1 rounded border border-fuchsia-500/20">Cartoonize</span>
                        <span class="text-[9px] bg-fuchsia-500/10 text-fuchsia-300 px-2 py-1 rounded border border-fuchsia-500/20">Y√ºz Koruma</span>
                    </div>
                </div>
                <div class="check-icon absolute top-4 right-4 w-6 h-6 bg-fuchsia-500 rounded-full flex items-center justify-center opacity-0 transform scale-50 transition-all duration-300 shadow-lg shadow-fuchsia-500/50">
                    <svg class="w-3.5 h-3.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                </div>
            </div>
        </div>
    </div>

    <div id="step-upload" class="hidden animate-fade-in">
        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4 ml-1">2. G√∂rseli Y√ºkle</h3>
        
        <div class="glass-panel rounded-2xl p-8">
            <div id="dropZone" class="border-2 border-dashed border-white/10 rounded-xl p-12 text-center hover:border-violet-500/50 hover:bg-white/5 transition cursor-pointer mb-0 relative group">
                <input type="file" id="fileInput" accept="image/png, image/jpeg, image/webp" class="hidden" onchange="handleFile(this.files[0])">
                <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform shadow-xl">
                    <svg class="w-10 h-10 text-gray-400 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                </div>
                <h4 class="text-xl font-bold text-white mb-2">G√∂rseli Buraya Bƒ±rakƒ±n</h4>
                <p class="text-sm text-gray-500">veya dosya se√ßmek i√ßin tƒ±klayƒ±n</p>
                <p class="text-xs text-gray-600 mt-4 font-mono">JPG, PNG ‚Ä¢ Max 15MB</p>
            </div>

            <div id="preview-area" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1">
                    <div class="relative rounded-xl overflow-hidden border border-white/10 bg-black/40 shadow-2xl">
                        <img id="img-preview" class="w-full h-auto object-cover opacity-80">
                        <button onclick="resetUpload()" class="absolute top-3 right-3 bg-black/60 hover:bg-red-600 text-white p-2 rounded-lg transition backdrop-blur-sm group">
                            <svg class="w-4 h-4 group-hover:rotate-90 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    
                    <div class="mt-4 p-4 bg-blue-500/5 border border-blue-500/10 rounded-xl">
                        <h5 class="text-xs font-bold text-blue-400 mb-2 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            ƒ∞pucu
                        </h5>
                        <p class="text-[11px] text-gray-400 leading-relaxed">
                            Nakƒ±≈ü i√ßin en iyi sonu√ß: Y√ºksek √ß√∂z√ºn√ºrl√ºkl√º, g√∂lgesiz ve net g√∂rsellerdir. Uzak √ßekimlerde y√ºz detaylarƒ± kaybolabilir.
                        </p>
                    </div>
                </div>

                <div class="lg:col-span-2 flex flex-col justify-between">
                    <div class="space-y-6">
                        <div class="flex items-center justify-between p-5 bg-white/5 rounded-xl border border-white/5 hover:border-yellow-500/30 transition cursor-pointer group">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-lg bg-yellow-500/10 flex items-center justify-center text-yellow-400 group-hover:scale-110 transition-transform">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                </div>
                                <div>
                                    <h5 class="text-sm font-bold text-white group-hover:text-yellow-400 transition-colors">4K Kalite Artƒ±rma (Upscale)</h5>
                                    <p class="text-xs text-gray-400">Bulanƒ±k g√∂rseli onarƒ±r, pikselleri netle≈ütirir.</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="upscale-toggle" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500"></div>
                            </label>
                        </div>

                        <div class="p-5 bg-white/5 rounded-xl border border-white/5">
                            <label class="text-xs font-bold text-gray-400 mb-3 block uppercase tracking-wide">Vekt√∂r Detay Seviyesi</label>
                            <div class="grid grid-cols-3 gap-3">
                                <button onclick="setQuality('medium')" id="q-medium" class="quality-btn py-3 rounded-lg border border-white/10 text-xs font-medium text-gray-400 hover:bg-white/5 transition">Basit</button>
                                <button onclick="setQuality('high')" id="q-high" class="quality-btn active py-3 rounded-lg border border-white/10 text-xs font-medium text-gray-400 hover:bg-white/5 transition">Dengeli</button>
                                <button onclick="setQuality('ultra')" id="q-ultra" class="quality-btn py-3 rounded-lg border border-white/10 text-xs font-medium text-gray-400 hover:bg-white/5 transition">Y√ºksek</button>
                            </div>
                        </div>
                    </div>

                    <button onclick="startProcessing()" class="mt-8 w-full py-4 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white font-bold shadow-lg shadow-violet-900/40 transition flex items-center justify-center gap-3 text-lg group">
                        <span>Vekt√∂rle≈ütirmeyi Ba≈ülat</span>
                        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="processing-overlay" class="hidden fixed inset-0 bg-[#02040a]/95 z-[60] flex flex-col items-center justify-center backdrop-blur-md animate-fade-in">
        <div class="w-72 h-72 relative rounded-2xl overflow-hidden mb-8 border border-white/10 bg-black shadow-2xl">
            <img id="process-preview-img" class="w-full h-full object-cover opacity-40">
            <div class="scan-line"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-5xl font-mono text-violet-400 font-bold drop-shadow-[0_0_10px_rgba(139,92,246,0.5)]" id="progress-percent">0%</div>
            </div>
        </div>
        <h3 class="text-2xl font-bold text-white mb-2 animate-pulse" id="process-step">Ba≈ülatƒ±lƒ±yor...</h3>
        <p class="text-sm text-gray-400">Yapay zeka nakƒ±≈ü optimizasyonu yapƒ±yor.</p>
    </div>

    <div id="result-screen" class="hidden animate-fade-in pb-20">
        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4 ml-1">3. Sonu√ß ve Nakƒ±≈ü Dosyasƒ±</h3>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
                <div class="glass-panel rounded-2xl p-2 relative h-full flex flex-col">
                    <div class="bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] bg-[#111827] rounded-xl overflow-hidden flex items-center justify-center flex-grow min-h-[500px]">
                        <img id="final-result-img" class="max-w-full max-h-[600px] object-contain drop-shadow-2xl">
                    </div>
                    
                    <div class="absolute top-6 right-6">
                        <span class="bg-green-500/20 text-green-400 text-xs font-bold px-3 py-1.5 rounded-full border border-green-500/20 flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            Vekt√∂r Hazƒ±r
                        </span>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mt-4 px-2 pb-2">
                        <button onclick="downloadVector()" class="py-3 rounded-lg bg-white/5 hover:bg-white/10 text-white font-medium border border-white/10 flex items-center justify-center gap-2 transition">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            SVG ƒ∞ndir
                        </button>
                        <button onclick="downloadPNG()" class="py-3 rounded-lg bg-white/5 hover:bg-white/10 text-white font-medium border border-white/10 flex items-center justify-center gap-2 transition">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            PNG ƒ∞ndir
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1">
                <div class="glass-panel rounded-2xl p-1 border border-violet-500/30 bg-gradient-to-b from-violet-900/10 to-[#0c1120] h-full flex flex-col">
                    
                    <div class="px-5 py-4 border-b border-white/5 flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-violet-600 flex items-center justify-center text-white shadow-lg shadow-violet-500/30 shrink-0">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-white">Nakƒ±≈ü D√∂n√º≈üt√ºr√ºc√º</h4>
                            <span class="text-[10px] uppercase font-bold text-violet-300">Auto-Digitize v4</span>
                        </div>
                    </div>

                    <div class="p-5 flex-grow flex flex-col">
                        <div class="flex p-1 bg-black/40 rounded-lg mb-6 border border-white/5">
                            <button onclick="switchTab('drawing')" id="tab-drawing" class="flex-1 py-2 rounded-md text-xs font-bold text-white bg-violet-600 shadow-md transition-all">√áizim Dosyasƒ±</button>
                            <button onclick="switchTab('machine')" id="tab-machine" class="flex-1 py-2 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all">Makine Dosyasƒ±</button>
                        </div>

                        <div id="content-drawing" class="space-y-3 flex-grow">
                            <p class="text-[10px] text-gray-400 mb-2">Wilcom/Corel ile d√ºzenlenebilir ham formatlar.</p>
                            <label class="cursor-pointer block">
                                <input type="radio" name="emb_format" value="emb" class="peer hidden" checked>
                                <div class="p-3 rounded-lg border border-white/10 bg-white/5 peer-checked:border-violet-500 peer-checked:bg-violet-500/10 hover:bg-white/10 transition flex items-center justify-between group">
                                    <span class="text-sm font-bold text-gray-300 group-hover:text-white">.EMB</span>
                                    <span class="text-[9px] text-gray-500 bg-white/5 px-1.5 py-0.5 rounded">Wilcom</span>
                                </div>
                            </label>
                            <label class="cursor-pointer block">
                                <input type="radio" name="emb_format" value="art" class="peer hidden">
                                <div class="p-3 rounded-lg border border-white/10 bg-white/5 peer-checked:border-violet-500 peer-checked:bg-violet-500/10 hover:bg-white/10 transition flex items-center justify-between group">
                                    <span class="text-sm font-bold text-gray-300 group-hover:text-white">.ART</span>
                                    <span class="text-[9px] text-gray-500 bg-white/5 px-1.5 py-0.5 rounded">Bernina</span>
                                </div>
                            </label>
                            <label class="cursor-pointer block">
                                <input type="radio" name="emb_format" value="pxf" class="peer hidden">
                                <div class="p-3 rounded-lg border border-white/10 bg-white/5 peer-checked:border-violet-500 peer-checked:bg-violet-500/10 hover:bg-white/10 transition flex items-center justify-between group">
                                    <span class="text-sm font-bold text-gray-300 group-hover:text-white">.PXF</span>
                                    <span class="text-[9px] text-gray-500 bg-white/5 px-1.5 py-0.5 rounded">Tajima</span>
                                </div>
                            </label>
                        </div>

                        <div id="content-machine" class="hidden space-y-4 flex-grow">
                            <p class="text-[10px] text-gray-400 mb-2">Makineye direkt y√ºklenen diki≈ü dosyalarƒ±.</p>
                            <div class="relative">
                                <select id="machine-format-select" class="w-full bg-[#02040a] border border-white/10 text-gray-300 text-sm rounded-lg focus:ring-violet-500 focus:border-violet-500 block p-3">
                                    <option value="dst">DST - Tajima (Standart)</option>
                                    <option value="pes">PES - Brother</option>
                                    <option value="jef">JEF - Janome</option>
                                    <option value="xxx">XXX - Singer</option>
                                    <option value="exp">EXP - Melco</option>
                                    <option value="vp3">VP3 - Husqvarna</option>
                                </select>
                            </div>
                            <div class="p-2 bg-yellow-500/10 border border-yellow-500/20 rounded text-[10px] text-yellow-200 flex gap-2">
                                <span>‚ö†Ô∏è</span>
                                <span>Makine dosyasƒ±nda renkler kaybolabilir (DST standardƒ±). ƒ∞plik sƒ±rasƒ±nƒ± kontrol edin.</span>
                            </div>
                        </div>

                        <button onclick="convertEmbroidery()" class="mt-6 w-full py-4 rounded-xl bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-500 hover:to-indigo-500 text-white font-bold shadow-lg shadow-violet-900/40 transition flex items-center justify-center gap-2 group">
                            <span>D√∂n√º≈üt√ºr ve ƒ∞ndir</span>
                            <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // DEƒûƒ∞≈ûKENLER
    let currentMode = null;
    let currentQuality = 'high';
    let selectedFile = null;
    let vectorData = null; // SVG Base64 (Backend'den gelecek)
    let pngData = null;    // PNG Base64

    // MOD SE√áƒ∞Mƒ∞
    function selectMode(mode) {
        currentMode = mode;
        
        document.getElementById('card-logo').classList.remove('selected');
        document.getElementById('card-photo').classList.remove('selected');
        
        document.getElementById('card-' + mode).classList.add('selected');
        
        document.getElementById('step-upload').classList.remove('hidden');
        setTimeout(() => document.getElementById('step-upload').scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
    }

    // KALƒ∞TE SE√áƒ∞Mƒ∞
    function setQuality(q) {
        currentQuality = q;
        ['medium', 'high', 'ultra'].forEach(qv => {
            const el = document.getElementById('q-' + qv);
            if (qv === q) el.classList.add('active');
            else el.classList.remove('active');
        });
    }

    // DOSYA Y√úKLEME
    function handleFile(file) {
        if (!file) return;
        selectedFile = file;
        
        const reader = new FileReader();
        reader.onload = (e) => {
            document.getElementById('img-preview').src = e.target.result;
            document.getElementById('process-preview-img').src = e.target.result;
            
            document.getElementById('dropZone').classList.add('hidden');
            document.getElementById('preview-area').classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    }

    function resetUpload() {
        selectedFile = null;
        document.getElementById('preview-area').classList.add('hidden');
        document.getElementById('dropZone').classList.remove('hidden');
        document.getElementById('fileInput').value = '';
    }

    // ƒ∞≈ûLEM BA≈ûLATMA (BACKEND BAƒûLANTISI BURAYA GELECEK)
    async function startProcessing() {
        if (!selectedFile) return alert("L√ºtfen dosya se√ßin.");

        const overlay = document.getElementById('processing-overlay');
        const stepText = document.getElementById('process-step');
        const percentText = document.getElementById('progress-percent');
        
        overlay.classList.remove('hidden');

        // --- BACKEND ƒ∞√áƒ∞N FORM DATA HAZIRLIƒûI ---
        const formData = new FormData();
        formData.append('image', selectedFile);
        formData.append('method', currentMode === 'logo' ? 'outline' : 'cartoon'); // Logo ise outline, foto ise cartoon
        
        // Kalite e≈üle≈ütirme
        let edgeThickness = 2;
        let colorCount = 16;
        if (currentQuality === 'medium') { edgeThickness = 3; colorCount = 8; }
        else if (currentQuality === 'ultra') { edgeThickness = 1; colorCount = 32; }
        
        formData.append('edge_thickness', edgeThickness);
        formData.append('color_count', colorCount);
        formData.append('style', 'cartoon'); // ERC motoru
        // ----------------------------------------

        try {
            // Sƒ∞M√úLASYON BA≈ûLANGICI (Backend'e istek atƒ±yor gibi davranƒ±yoruz)
            let progress = 0;
            const steps = [
                {p: 10, t: "G√∂rsel Y√ºkleniyor..."},
                {p: 30, t: currentMode === 'logo' ? "Vekt√∂r √áizgileri Ayrƒ±≈ütƒ±rƒ±lƒ±yor..." : "ERC v4 Motoru Ba≈ülatƒ±lƒ±yor..."},
                {p: 50, t: "Y√ºz ve Detay Analizi Yapƒ±lƒ±yor..."},
                {p: 75, t: "Renkler Nakƒ±≈ü ƒ∞√ßin Optimize Ediliyor..."},
                {p: 90, t: "SVG Olu≈üturuluyor..."},
                {p: 100, t: "Tamamlanƒ±yor!"}
            ];

            // Ger√ßek fetch isteƒüi buraya gelecek:
            const res = await fetch('/api/vectorize', { method: 'POST', body: formData });
            const data = await res.json(); 

            // Sim√ºle edilmi≈ü progress bar (Ger√ßekte backend'den yanƒ±t beklerken d√∂ner)
            const interval = setInterval(() => {
                progress += Math.floor(Math.random() * 10) + 5;
                if (progress > 100) progress = 100;
                
                percentText.innerText = progress + "%";
                const currentStep = steps.find(s => progress >= s.p);
                if (currentStep) stepText.innerText = currentStep.t;

                if (progress === 100) {
                    clearInterval(interval);
                    
                    if (data.success) {
                        // SONU√áLARI G√ñSTER
                        vectorData = data.file;
                        pngData = data.preview_img;
                        
                        document.getElementById('final-result-img').src = "data:image/png;base64," + pngData;
                        
                        setTimeout(() => {
                            overlay.classList.add('hidden');
                            document.getElementById('result-screen').classList.remove('hidden');
                            document.getElementById('result-screen').scrollIntoView({ behavior: 'smooth' });
                        }, 500);
                    } else {
                        alert("Hata: " + data.message);
                        overlay.classList.add('hidden');
                    }
                }
            }, 300); // Hƒ±zlƒ± sim√ºlasyon (300ms)

        } catch (e) {
            console.error(e);
            alert("Sunucu hatasƒ± veya sim√ºlasyon modundasƒ±nƒ±z (Backend yok).");
            overlay.classList.add('hidden');
        }
    }

    // NAKI≈û TABLARI
    function switchTab(tab) {
        const btnDraw = document.getElementById('tab-drawing');
        const btnMach = document.getElementById('tab-machine');
        const contentDraw = document.getElementById('content-drawing');
        const contentMach = document.getElementById('content-machine');

        if (tab === 'drawing') {
            btnDraw.className = "flex-1 py-2 rounded-md text-xs font-bold text-white bg-violet-600 shadow-md transition-all";
            btnMach.className = "flex-1 py-2 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all";
            contentDraw.classList.remove('hidden');
            contentMach.classList.add('hidden');
        } else {
            btnMach.className = "flex-1 py-2 rounded-md text-xs font-bold text-white bg-blue-600 shadow-md transition-all";
            btnDraw.className = "flex-1 py-2 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all";
            contentDraw.classList.add('hidden');
            contentMach.classList.remove('hidden');
        }
    }

    // NAKI≈û D√ñN√ú≈ûT√úRME (A≈ûAMA 4 - Placeholder)
    function convertEmbroidery() {
        if (!vectorData) return alert("L√ºtfen √∂nce vekt√∂r olu≈üturun.");
        
        // Se√ßilen formatƒ± al
        const isMachine = document.getElementById('content-drawing').classList.contains('hidden');
        let format = isMachine ? document.getElementById('machine-format-select').value : document.querySelector('input[name="emb_format"]:checked').value;

        alert(`üöß Geli≈ütirme A≈üamasƒ±nda:\n\nSe√ßilen Format: .${format.toUpperCase()}\n\nBu √∂zellik backend'e 'pyembroidery' eklendikten sonra √ßalƒ±≈üacaktƒ±r.`);
    }

    // ƒ∞NDƒ∞RME BUTONLARI
    function downloadVector() {
        if (!vectorData) return;
        const link = document.createElement('a');
        link.href = "data:image/svg+xml;base64," + vectorData;
        link.download = `vektor_${currentMode}.svg`;
        link.click();
    }

    function downloadPNG() {
        if (!pngData) return;
        const link = document.createElement('a');
        link.href = "data:image/png;base64," + pngData;
        link.download = `vektor_onizleme_${currentMode}.png`;
        link.click();
    }
</script>

</body>
</html>
